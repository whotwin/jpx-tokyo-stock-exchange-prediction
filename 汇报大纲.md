# 课程汇报：JPX东京证券交易所股票收益预测

---

## 一、任务介绍

### 1.1 任务背景

日本交易所集团（Japan Exchange Group, JPX）是全球最大的股票交易所之一，主办此次竞赛旨在推动量化投资策略的研究与创新。随着金融市场的日益复杂化，传统的分析方法已难以满足投资者对高效决策工具的需求。机器学习与深度学习技术的引入，为股票收益率预测提供了新的思路。

在股票市场中，准确预测股票收益并构建有效的投资组合是量化投资的核心目标。然而，股票市场具有高度随机性和复杂性，受多种因素影响，包括宏观经济环境、行业动态、公司财务状况以及市场情绪等。如何从海量数据中提取有效特征并建立可靠的预测模型，是一个极具挑战性的问题。

本项目基于JPX东京证券交易所的历史交易数据，旨在利用机器学习方法预测股票未来收益率，并构建相应的投资组合策略。

### 1.2 任务数据

本项目使用的数据来源于JPX东京证券交易所，主要包含以下六个数据文件：

| 数据文件 | 记录数 | 时间范围 |
|----------|--------|----------|
| stock_prices.csv | 约233万条 | 2017-01 至 2021-12 |
| stock_list.csv | 4,417只股票 | - |
| financials.csv | 约10万条 | 季度数据 |
| trades.csv | 约5,000条 | 周度数据 |
| options.csv | - | 日度数据 |
| secondary_stock_prices.csv | - | 二板股票 |

**预测范围**：约2000只股票（Universe0=True，按市值排名前2000）

#### 1.2.1 股票价格数据（stock_prices.csv）

这是最核心的数据文件，记录每日股票交易信息：

| 字段 | 类型 | 说明 | 在预测中的作用 |
|------|------|------|----------------|
| Date | date | 交易日期 | 时间序列索引 |
| SecuritiesCode | int | 股票代码 | 股票标识 |
| Open | float | 开盘价 | 短期价格特征 |
| High | float | 最高价 | 日内波动特征 |
| Low | float | 最低价 | 日内波动特征 |
| Close | float | 收盘价 | 计算收益率的核心字段 |
| Volume | int | 成交量 | 流动性特征 |
| AdjustmentFactor | float | 调整因子 | 复权价格计算 |
| ExpectedDividend | float | 预期分红 | 股息收益预期 |
| SupervisionFlag | boolean | 监管标志 | 特殊股票过滤 |
| **Target** | float | **预测目标** | t+2与t+1的调整后收盘价变化率 |

**如何反映股市状况**：收盘价直接反映股票价值，成交量反映市场活跃度，高低价差反映日内波动性。通过计算不同周期的收益率（如1天、5天、20天）可以捕捉股票的趋势特征。

**可提取特征**：
- 收益率：1/2/3/5/10/20天收益率
- 波动率：5/10/20天滚动标准差
- 移动平均：5/10/20日均线偏离度
- 成交量变化：成交量增减

#### 1.2.2 股票列表数据（stock_list.csv）

提供股票的基本信息：

| 字段 | 类型 | 说明 |
|------|------|------|
| SecuritiesCode | int | 股票代码 |
| Name | string | 公司名称 |
| Section/Products | string | 板块分类 |
| 33SectorName | string | 33行业分类 |
| 17SectorName | string | 17行业分类 |
| MarketCapitalization | float | 市值 |
| NewMarketSegment | string | 市场分层（Prime/Standard/Growth） |
| **Universe0** | boolean | **预测目标标记** |

**如何反映股市状况**：市值反映公司规模，行业分类可用于行业轮动策略，Market Segment反映股票流动性层次。

**可提取特征**：
- 市值因子（大/中/小盘）
- 行业因子（33行业分类编码）
- 市场分层因子（Prime/Standard）

#### 1.2.3 财务报表数据（financials.csv）

季度披露的财务数据：

| 字段 | 说明 | 在预测中的作用 |
|------|------|----------------|
| NetSales | 净销售额 | 营收规模 |
| OperatingProfit | 营业利润 | 盈利能力 |
| OrdinaryProfit | 经常利润 | 经营效率 |
| Profit | 净利润 | 最终盈利 |
| TotalAssets | 总资产 | 资产规模 |
| Equity | 净资产 | 股东权益 |
| EquityToAssetRatio | 净资产比率 | 财务杠杆 |
| EarningsPerShare (EPS) | 每股收益 | 每股盈利 |
| ForecastNetSales | 预期净销售额 | 业绩预期 |
| ForecastProfit | 预期净利润 | 业绩预期 |

**如何反映股市状况**：财务数据反映公司的基本面价值，盈利能力强的公司通常具有更高的内在价值。投资者常使用市净率（P/B）、市盈率（P/E）等估值指标，这些都基于财务数据计算。

**可提取特征**：
- ROE（净资产收益率）= Profit / Equity
- 毛利率 = OperatingProfit / NetSales
- 资产周转率 = NetSales / TotalAssets

#### 1.2.4 投资者交易数据（trades.csv）

周度披露的各类投资者买卖行为：

| 字段 | 说明 |
|------|------|
| Individuals | 个人投资者买卖额 |
| Foreigners | 外国投资者买卖额 |
| SecuritiesCos | 证券公司买卖额 |
| InvestmentTrusts | 投资信托买卖额 |
| InsuranceCos | 保险公司买卖额 |
| TrustBanks | 信托银行买卖额 |

**如何反映股市状况**：
- **外资动向**：外资通常被视为"聪明钱"，其大幅买入常预示上涨
- **个人投资者**：情绪指标，恐慌性卖出可能是底部信号
- **机构投资者**：专业判断，订单流具有信息含量

**可提取特征**：
- 各类投资者净买入额
- 外资占比变化
- 机构vs个人投资者博弈

#### 1.2.5 期权数据（options.csv）

期权市场数据：

| 字段 | 说明 | 在预测中的作用 |
|------|------|----------------|
| ImpliedVolatility | 隐含波动率 | 市场风险预期 |
| StrikePrice | 行权价 | 期权定价 |
| SettlementPrice | 结算价格 | 期权价值 |
| Putcall | 看跌(1)/看涨(2) | 期权类型 |
| ContractMonth | 合约月份 | 期限结构 |
| BaseVolatility | 基础波动率 | 波动率基准 |

**如何反映股市状况**：隐含波动率（IV）是市场对未来价格波动的预期，当IV异常升高时往往预示市场恐慌。期权市场的"看跌/看涨比率"也是常用的市场情绪指标。

**可提取特征**：
- 平均隐含波动率
- 波动率期限结构

#### 1.2.6 二板股票数据（secondary_stock_prices.csv）

创业板/中小板股票的价格数据，字段与主版stock_prices相同。

### 1.3 任务目标

**原始竞赛目标**（改编前）：
- 预测日本东京证券交易所股票的次日收益率
- 按预期收益对股票进行排名
- 买入预测收益最高的前200只股票，卖空预测收益最低的200只股票
- 最终通过Sharpe比率评估模型效果

**本项目任务目标**（改编后）：
- **预测期限调整**：原比赛预测提前1天，我们调整为预测**未来30天**的股票收益率，以减少市场噪声影响
- **模型构建**：使用LightGBM等机器学习模型，结合多数据源特征进行预测
- **集成学习**：实现多模型加权集成，提升预测稳定性
- **超参数优化**：采用扩展Grid Search方法进行参数寻优

**关于"选取前200支和后200支股票"的逻辑说明**：

为什么选择200这个数字而非全部股票或其他比例？这一设计背后有其深刻的金融学逻辑：

1. **尾部收益策略的核心思想**
   - 在股票市场中，真正产生Alpha（超额收益）的是**相对价值差异**而非绝对收益
   - 前200名与后200名的收益差（Spread）反映了市场的相对定价错误
   - 预测"谁涨得最多"比预测"谁会涨"更容易，因为相对排序的噪声更小

2. **流动性与交易成本的平衡**
   - 200只股票既保证了足够的**分散化**（降低单只股票的特殊风险）
   - 又不会因为持仓过多而导致**交易成本**过高
   - 日本主板市场有足够的流动性支撑200只股票的买卖

3. **为什么不是按比例划分？**
   - 按比例划分（如前10%、后10%）会导致持仓数量随股票总数波动
   - 固定200 vs 200 提供了**稳定的策略容量**，便于比较不同模型效果
   - 200对200的long-short组合可以有效对冲市场系统性风险（Beta）

4. **实际可行性**
   - 实际量化基金广泛采用类似的长短仓策略（Long-Short Strategy）
   - 该策略不依赖于预测市场的涨跌方向，而是赚取**相对收益**
   - 有效降低了市场风险敞口，使策略更稳健

5. **若全部纳入的缺陷**
   - 预测所有2000只股票的准确率难以评估，且计算成本高昂
   - 中间部分的股票收益差异小，排序的边际价值低
   - 持仓过于分散会稀释Alpha信号，整体收益下降

### 1.4 任务潜在收益

1. **学术价值**：探索机器学习在金融预测领域的应用边界，验证不同特征工程方法的有效性
2. **实践价值**：为投资者提供股票收益率预测工具，辅助投资决策
3. **方法论贡献**：积累多数据源融合、多模型集成等技术在金融领域的应用经验
4. **风险控制**：通过Sharpe比率等指标评估策略风险收益特征

---

## 二、技术方案与挑战

### 2.1 特征工程方案

#### 方案A：基于单一数据源的特征

仅使用股票价格数据（stock_prices）构建技术指标特征。

| 特征类型 | 具体指标 | 说明 |
|----------|----------|------|
| 收益率特征 | 1/2/3/5/10/20天收益率 | 捕捉不同周期的价格趋势 |
| 波动率特征 | 5/10/20天滚动标准差 | 衡量风险水平 |
| 动量特征 | 移动平均偏离度 | 股价相对均线的位置 |
| 成交量特征 | 成交量变化、成交量/均值 | 市场活跃程度 |
| 日内特征 | (High-Low)/Close, (Close-Open)/Open | 日内波动模式 |

**优势**：数据获取简单，特征计算直观
**劣势**：信息维度单一，缺少基本面和市场情绪信息

#### 方案B：多数据源融合特征（推荐）

整合股票价格、期权、交易、财务等多维度数据。

| 数据源 | 特征类型 | 具体指标 |
|--------|----------|----------|
| 股票价格 | 技术指标 | 收益率、波动率、均线等 |
| 股票列表 | 市值因子 | log(市值)、行业编码、市场分层 |
| 财务报表 | 基本面因子 | ROE、毛利率、资产周转率 |
| 投资者交易 | 情绪因子 | 外资净买入、机构净买入 |
| 期权数据 | 波动率因子 | 隐含波动率、波动率期限结构 |

**优势**：信息维度丰富，可捕捉多角度的市场信号
**劣势**：数据处理复杂，需处理不同频率数据的对齐

### 2.2 模型选择方案

#### 方案A：时间序列深度学习模型（LSTM/Transformer）

| 方案 | 描述 | 优势 | 劣势 |
|------|------|------|------|
| LSTM | 长短时记忆网络，捕捉时序依赖 | 能学习长期时序模式 | 训练成本高，容易过拟合 |
| GRU | 简化版LSTM，参数更少 | 训练更快 | 表达能力略弱 |
| Transformer | 自注意力机制 | 并行计算，长距离依赖 | 数据需求大，可解释性差 |

**适用场景**：数据量充足，GPU资源丰富

#### 方案B：传统机器学习模型（推荐）

| 方案 | 描述 | 优势 | 劣势 |
|------|------|------|------|
| LightGBM | 梯度提升树 | 训练快，特征可解释，对缺失值鲁棒 | 需要人工特征工程 |
| XGBoost | 梯度提升树 | 泛化能力强 | 训练较慢 |
| Ridge回归 | 线性模型 | 简单稳定，可解释 | 难以捕捉非线性关系 |

**适用场景**：特征工程完善，追求稳定性和可解释性

**本项目选择**：LightGBM回归 + LightGBM分类的混合方案
- 回归模型预测收益率具体值
- 分类模型预测涨跌方向
- 混合预测 = 回归预测 × (2×分类概率 - 1)

### 2.3 集成学习方案

#### 方案A：随机森林

- **原理**：同一算法，使用不同子样本和特征子集训练多棵树，投票/平均
- **本质**：同模型多实例
- **适用**：单一数据源、特征重要性评估

#### 方案B：多模型加权集成（推荐）

- **原理**：不同算法或不同数据源训练独立模型，按验证集性能加权
- **本质**：多种模型，优势互补
- **适用**：多数据源、多角度预测

| 集成方式 | 说明 | 例子 |
|----------|------|------|
| Bagging | 同模型多实例 | 随机森林 |
| Boosting | 串行迭代优化 | AdaBoost、GBM |
| Stacking | 元学习器组合 | 用Ridge组合多个基模型 |
| 加权平均 | 按性能分配权重 | 本项目采用 |

**本项目选择**：多数据源加权集成
- 为每个数据源训练独立模型
- 根据验证集Spearman相关系数分配权重
- 最终预测 = 加权平均

### 2.4 数据划分与验证策略

#### 方案A：随机划分

将数据随机分为训练集/验证集/测试集。

**问题**：违反时间序列原则，用未来数据预测过去。

#### 方案B：时间序列划分（推荐）

按时间顺序划分，确保训练数据在测试数据之前。

| 方案 | 训练数据 | 验证数据 | 测试数据 |
|------|----------|----------|----------|
| 扩展窗口 | 2017-2019 | 2020 | 2021 |
| 滚动窗口 | 过去2年 | 最近1年 | 下一年 |

**本项目选择**：扩展窗口
- 使用2017-2020年数据训练
- 验证集用于超参数调优
- 2021年为测试集

### 2.5 超参数优化方案

#### 方案A：基础Grid Search

测试所有参数组合（12种左右）。

#### 方案B：扩展Grid Search（推荐）

增加参数种类和取值范围，使用多验证集对。

| 参数 | 取值范围 |
|------|----------|
| n_estimators | 100, 300, 500 |
| learning_rate | 0.01, 0.02, 0.05 |
| max_depth | 4, 6, 8 |
| num_leaves | 15, 31, 63 |
| min_child_samples | 10, 20 |
| feature_fraction | 0.6, 0.8 |
| bagging_fraction | 0.6, 0.8 |
| reg_alpha | 0.1, 0.4 |
| reg_lambda | 0.1, 0.4 |

**验证集对**：(2017,2018)、(2018,2019)、(2019,2020)

### 2.6 评价指标体系

| 指标 | 说明 | 选择理由 |
|------|------|----------|
| **Spearman相关系数** | 预测值与真实值的排序相关性 | 核心指标，衡量排序能力 |
| **Sharpe比率** | (组合收益-无风险利率)/收益标准差 | 衡量风险调整后收益 |
| **RMSE** | 均方根误差 | 衡量预测精度 |
| **Hit比率** | 预测方向正确的比例 | 衡量方向准确率 |

**指标优先级**：
1. Sharpe比率（投资组合层面的最终效果）
2. Spearman相关系数（排序预测能力）
3. Hit比率（方向判断）
4. RMSE（数值精度）

### 2.7 任务挑战与难点

#### （1）历史数据时间窗口的选择

**问题**：是否使用的历史数据越多，预测就越准确？

**分析**：
- **市场regime change**：2017-2021年间市场经历多次重大变化，不同时期规律不同
- **过拟合风险**：过多历史数据可能导致模型"记住"过去模式
- **数据时效性**：金融市场有效性提高，太久远的数据可能失效

**应对策略**：采用**滚动窗口**，限制训练数据在2-3年内

#### （2）评估方式的思考

**问题**：关注精确排名还是Top-K准确率？

| 评估方式 | 说明 |
|----------|------|
| 精确排名 | 要求第i名与实际第i名完全一致 |
| Top-K准确率 | 预测的前K名中包含实际前K名 |
| Spearman相关 | 衡量整体排序相关性 |

**本项目选择**：Spearman相关系数 + Sharpe比率
- 投资组合只需"选中好的"，而非"排对顺序"
- Sharpe比率直接衡量策略风险收益

#### （3）时间序列模型 vs 传统机器学习

| 模型类型 | 适用场景 |
|----------|----------|
| LSTM等时序模型 | 需要捕捉长期时序依赖 |
| 传统机器学习 | 依赖截面特征，对非平稳性更鲁棒 |

**本项目选择**：LightGBM
- 股票收益更多依赖**截面特征**（同一时刻不同股票的相对特征）
- 特征工程可融入领域知识

#### （4）多模型集成 vs 随机森林

| 概念 | 说明 |
|------|------|
| 随机森林 | 同模型多实例 |
| 多模型集成 | 不同算法/数据源的优势互补 |

**本项目选择**：多数据源加权集成
- 为股票价格、期权、交易、财务分别训练模型
- 根据验证集性能分配权重

---

## 三、总结与预期成果

本项目围绕JPX东京证券交易所股票收益预测任务，拟采用以下技术路线：

1. **数据处理**：整合多数据源（股票价格、财务报表、投资者交易、期权数据）
2. **特征工程**：构建技术指标、基本面因子、情绪因子等多维度特征
3. **模型选择**：LightGBM回归+分类混合预测
4. **集成学习**：多数据源加权集成
5. **超参数优化**：扩展Grid Search + 多验证集

**预期成果**：
- 建立完整的股票收益预测pipeline
- 验证多数据源融合的有效性
- 产出可解释的投资组合策略

---

*（后续汇报将详细展开实验结果与分析）*
